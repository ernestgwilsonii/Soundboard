<div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarMenu" aria-labelledby="sidebarMenuLabel">
    <div class="offcanvas-header bg-dark text-white">
        <h5 class="offcanvas-title" id="sidebarMenuLabel">
            <i class="fas fa-bars me-2"></i>Menu
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body p-0">
        <div class="list-group list-group-flush">
            <a href="{{ url_for('main.index') }}" class="list-group-item list-group-item-action py-3">
                <i class="fas fa-home me-3 text-primary"></i>Home
            </a>
            <a href="{{ url_for('soundboard.gallery') }}" class="list-group-item list-group-item-action py-3">
                <i class="fas fa-compass me-3 text-success"></i>Explore Gallery
            </a>
            
            {% if current_user.is_authenticated %}
            <div class="bg-light px-3 py-2 small fw-bold text-uppercase border-top border-bottom">My Soundboards</div>
            <div id="sidebar-my-boards">
                <!-- Placeholder for dynamic list -->
                <div class="px-3 py-2 text-muted small italic">Loading...</div>
            </div>

            <div class="bg-light px-3 py-2 small fw-bold text-uppercase border-top border-bottom">My Playlists</div>
            <div id="sidebar-playlists">
                <!-- Placeholder for dynamic list -->
                <div class="px-3 py-2 text-muted small italic">No playlists yet.</div>
            </div>

            <div class="bg-light px-3 py-2 small fw-bold text-uppercase border-top border-bottom">Favorites & Pinned</div>
            <div id="sidebar-favorites">
                <!-- Placeholder for dynamic list -->
                <div class="px-3 py-2 text-muted small italic">No favorites yet.</div>
            </div>
            {% endif %}

            <div class="bg-light px-3 py-2 small fw-bold text-uppercase border-top border-bottom">Explore community</div>
            <div id="sidebar-explore" style="max-height: 400px; overflow-y: auto;">
                <!-- Placeholder for dynamic list -->
                <div class="px-3 py-2 text-muted small italic">Loading...</div>
            </div>

            <div class="bg-light px-3 py-2 small fw-bold text-uppercase border-top border-bottom">Popular Tags</div>
            <div id="sidebar-tags" class="px-3 py-2">
                <!-- Placeholder for dynamic list -->
                <div class="text-muted small italic">Loading...</div>
            </div>

            <div class="bg-light px-3 py-2 small fw-bold text-uppercase border-top border-bottom">Other</div>
            <a href="{{ url_for('soundboard.search') }}" class="list-group-item list-group-item-action py-3">
                <i class="fas fa-search me-3"></i>Search All Boards
            </a>
        </div>
    </div>
    <div class="offcanvas-footer p-3 border-top text-center">
        <small class="text-muted">&copy; 2025 Soundboard</small>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('sidebarMenu');
    sidebar.addEventListener('show.bs.offcanvas', function () {
        fetch('{{ url_for("main.sidebar_data") }}')
            .then(response => response.json())
            .then(data => {
                const myBoardsContainer = document.getElementById('sidebar-my-boards');
                const favoritesContainer = document.getElementById('sidebar-favorites');
                const exploreContainer = document.getElementById('sidebar-explore');
                const playlistsContainer = document.getElementById('sidebar-playlists');
                
                if (myBoardsContainer) {
                    if (data.my_boards.length > 0) {
                        myBoardsContainer.innerHTML = data.my_boards.map(sb => `
                            <a href="/soundboard/view/${sb.id}" class="list-group-item list-group-item-action py-2 border-0">
                                <i class="${sb.icon && !sb.icon.includes('/') ? sb.icon : 'fas fa-music'} me-2 small"></i>
                                ${sb.name}
                            </a>
                        `).join('');
                    } else {
                        myBoardsContainer.innerHTML = '<div class="px-3 py-2 text-muted small italic">No soundboards yet.</div>';
                    }
                }

                if (playlistsContainer) {
                    if (data.my_playlists.length > 0) {
                        playlistsContainer.innerHTML = data.my_playlists.map(pl => `
                            <a href="/soundboard/playlist/${pl.id}" class="list-group-item list-group-item-action py-2 border-0">
                                <i class="fas fa-list me-2 small"></i>
                                ${pl.name}
                            </a>
                        `).join('');
                    } else {
                        playlistsContainer.innerHTML = '<div class="px-3 py-2 text-muted small italic">No playlists yet.</div>';
                    }
                }

                if (favoritesContainer) {
                    if (data.favorites.length > 0) {
                        favoritesContainer.innerHTML = data.favorites.map(sb => `
                            <a href="/soundboard/view/${sb.id}" class="list-group-item list-group-item-action py-2 border-0">
                                <i class="${sb.icon && !sb.icon.includes('/') ? sb.icon : 'fas fa-music'} me-2 small text-warning"></i>
                                ${sb.name}
                            </a>
                        `).join('');
                    } else {
                        favoritesContainer.innerHTML = '<div class="px-3 py-2 text-muted small italic">No favorites yet.</div>';
                    }
                }

                if (exploreContainer) {
                    let exploreHtml = '';
                    const creators = Object.keys(data.explore).sort();
                    if (creators.length > 0) {
                        creators.forEach(creator => {
                            exploreHtml += `<div class="px-3 py-1 mt-2 small text-muted border-bottom">${creator}</div>`;
                            data.explore[creator].forEach(sb => {
                                exploreHtml += `
                                    <a href="/soundboard/view/${sb.id}" class="list-group-item list-group-item-action py-2 border-0">
                                        <i class="${sb.icon && !sb.icon.includes('/') ? sb.icon : 'fas fa-music'} me-2 small"></i>
                                        ${sb.name}
                                    </a>
                                `;
                            });
                        });
                        exploreContainer.innerHTML = exploreHtml;
                    } else {
                        exploreContainer.innerHTML = '<div class="px-3 py-2 text-muted small italic">No public boards yet.</div>';
                    }
                }

                const tagsContainer = document.getElementById('sidebar-tags');
                if (tagsContainer) {
                    if (data.popular_tags.length > 0) {
                        tagsContainer.innerHTML = data.popular_tags.map(tag => `
                            <a href="/soundboard/tag/${tag.name}" class="badge rounded-pill bg-light text-dark border text-decoration-none me-1 mb-1">
                                #${tag.name}
                            </a>
                        `).join('');
                    } else {
                        tagsContainer.innerHTML = '<div class="text-muted small italic">No tags yet.</div>';
                    }
                }
            })
            .catch(error => console.error('Error fetching sidebar data:', error));
    });
});
</script>

<style>
    #sidebarMenu {
        width: 280px;
        border-right: none;
        box-shadow: 5px 0 15px rgba(0,0,0,0.1);
    }
    .list-group-item {
        border-left: 4px solid transparent;
        transition: all 0.2s;
        font-size: 0.95rem;
    }
    .list-group-item:hover {
        border-left: 4px solid var(--bs-primary);
        background-color: rgba(var(--bs-primary-rgb), 0.05);
        color: var(--bs-primary);
    }
    .list-group-item.active {
        background-color: rgba(var(--bs-primary-rgb), 0.1);
        color: var(--bs-primary);
        font-weight: 600;
        border-left: 4px solid var(--bs-primary);
    }
    .list-group-item i {
        width: 24px;
        text-align: center;
    }
    #sidebar-explore {
        max-height: 50vh;
        overflow-y: auto;
        scrollbar-width: thin;
    }
    #sidebar-explore::-webkit-scrollbar {
        width: 4px;
    }
    #sidebar-explore::-webkit-scrollbar-thumb {
        background: #ccc;
        border-radius: 4px;
    }
    
    /* Mobile adjustments */
    @media (max-width: 576px) {
        #sidebarMenu {
            width: 85%;
        }
    }
</style>
